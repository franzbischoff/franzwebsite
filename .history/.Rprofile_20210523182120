# nolint start
source("renv/activate.R")

if (Sys.getenv("CI") == "") { # not CI

  suppressMessages(if (requireNamespace("languageserver")) {
    a <- try(suppressWarnings(source(file.path(
      Sys.getenv(if (.Platform$OS.type == "windows") {
        "USERPROFILE"
      } else {
        "HOME"
      }),
      ".vscode-R",
      "init.R"
    ))),
    silent = TRUE
    )

    rm(a)
  })

  if (interactive()) {
    options(
      warnPartialMatchArgs = FALSE,
      warnPartialMatchDollar = FALSE,
      warnPartialMatchAttr = FALSE,
      usethis.protocol = "https",
      vsc.rstudioapi = TRUE
      # error = recover
    )

    suppressMessages(
      suppressWarnings({
        require("testthat", quietly = TRUE)
        require("devtools", quietly = TRUE)
        require("usethis", quietly = TRUE)
        require("conflicted", quietly = TRUE)
        require("here", quietly = TRUE)
      })
    )
    # suppressMessages(prettycode::prettycode())

    if (suppressMessages(requireNamespace("prompt", quietly = TRUE))) {
      prompt::set_prompt(function(...) {
        paste0(
          "[",
          prompt::git_branch(),
          prompt::git_dirty(),
          prompt::git_arrows(),
          "] ",
          prompt::prompt_runtime()
        )
      })
    }
  }
} else { # is CI
  message("Running .RProfile in CI")
}

options(
  blogdown.author = "Francisco Bischoff"
  blogdown.ext = ".Rmd", # Default extension of new posts: .md / .Rmd / .Rmarkdown
  # blogdown.filename.pre_processor = NA,
  blogdown.files_filter = blogdown:::filter_md5sum,
  blogdown.generator = "hugo",
  # blogdown.hugo.args = "--minify",
  # blogdown.hugo.dir = NA, # The directory of the Hugo executable
  # blogdown.hugo.server = c("-D", "-F", "--navigateToChanged"),
  blogdown.hugo.version = "0.83.1",
  # blogdown.initial_files = NA,
  blogdown.insertimage.usebaseurl = TRUE, # RBloggers, https://github.com/rstudio/blogdown/blob/5aeb809c68cfa1a9e616bc9ed9878c3ea5d05300/NEWS.md#new-features-13
  blogdown.knit.on_save = TRUE,
  blogdown.knit.serve_site = FALSE,
  # blogdown.markdown.format = c("gfm", "+footnotes", "+tex_math_dollars", "+smart"),
  blogdown.method = "html", # The building method for R Markdown
  # blogdown.rename_file = NA,
  blogdown.new_bundle = TRUE, # Create a new post in a bundle (new Hugo format)
  blogdown.protect.math = TRUE,
  # blogdown.publishDir = "../public_site", # The publish dir for local preview, to avoid RStudio for get busy tracking files
  blogdown.serve_site.startup = FALSE,
  # blogdown.server.timeout = NA,
  blogdown.server.verbose = TRUE,
  # blogdown.server.wait = 2,
  # blogdown.site_root = NA,
  blogdown.subdir = "posts", # Default subdirectory under content/ for new posts
  # blogdown.subdir_fun = NA, # function. Update subdir in according to the title
  # blogdown.time_diff = NA,
  blogdown.title_case = FALSE,
  blogdown.warn.future = TRUE,
  # blogdown.widgetsID = NA, # Incremental IDs for HTML widgets
  blogdown.yaml.empty = TRUE # Preserve empty fields in YAML
)

library(blogdown)

# nolint end
